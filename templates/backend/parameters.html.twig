{% extends 'includes/backend_sidebar.html.twig' %}

{% block title %}Asitur{% endblock %}

{% block stylesheets %}
{{parent()}}

    <link rel="stylesheet" href="{{ asset('css/backend/style-backend_general.css') }}">

{% endblock %}

{% block content %}

    <!--Page Title-->
    <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
    <div id="page-title">
        <h1 class="page-header text-overflow">{{"backend.parameters.header"|trans}}</h1>
    </div>
    <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
    <!--End page title-->

    <!--Page content-->
    <!--===================================================-->
    <div id="page-content">

        <div>
            <p><b><a class="text-danger animated infinite flash" style="animation-duration: 5s;">{{'general.important'|trans}}</a></b> <span>{{'backend.parameters.warning'|trans}}: <b><i>fixParametersCommand.php</i></b></span></p>
        </div>

        <div style="display: block;
                    margin-bottom: 10px;
                    margin-right: 24px;
                    margin-top: 20px;
                    float: right;">
            <label class="control-label">{{"general.search"|trans}}:</label>
            <input id="search-input" class='search-input' type="text" placeholder="{{"general.search"|trans}}..." spellcheck="false">
        </div>

        <!-- Tabla Traducciones -->
        <!--===================================================-->
        <div class="panel">
            <div class="panel-body">
                <table id="table_parameters" class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>{{"dataTable.parameters.name"|trans}}</th>
                            <th>{{"dataTable.parameters.type"|trans}}</th>
                            <th>{{"dataTable.parameters.value"|trans}}</th>
                            <th>{{"dataTable.parameters.description"|trans}}</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <!--===================================================-->
    

    </div>
    <!--===================================================-->
    <!--End page content-->

{% endblock %}

{% block javascripts %}
    {{parent()}}

<script>
    $(document).ready(function(){
        $("#parameters_li").addClass("active-link");

        var time = null;
        createTable();

        $('#search-input').keyup(function() {
            clearInterval(time);
            time = setTimeout(function() {
                reloadDataTable();
            }, 1500);
        });

    });

    function createTable() {

        $('#table_parameters').DataTable({
            order: [0, 'ASC'],
            searching: false,
            lengthMenu: [
                [10, 25, 50, 100, -1],
                [10, 25, 50, 100,
                    "{{('dataTable.general.lengthMenu.all')|trans}}"
                ]
            ],
            responsive: false,
            autoWidth: false,
            scrollX: true,
            processing: false,
            serverSide: true,
            pagingType: "full_numbers",
            language: {
                "sProcessing": "{{ 'dataTable.general.language.sProcessing' | trans }}",
                "sLengthMenu": "{{ ('dataTable.general.language.sLengthMenu') | trans}}",
                "sZeroRecords": "{{ ('dataTable.general.language.sZeroRecords') | trans }}",
                "sEmptyTable": "{{ ('dataTable.general.language.sZeroRecords') | trans }}",
                "sInfo": "{{ ('dataTable.general.language.sInfo') | trans }}",
                "sInfoEmpty": "{{ ('dataTable.general.language.sInfoEmpty') | trans }}",
                "sInfoFiltered": "{{ ('dataTable.general.language.sInfoFiltered') | trans }}",
                "sInfoPostFix": "",
                "sSearch": "{{ ('dataTable.general.language.sSearch') | trans }}:",
                "sUrl": "",
                "sInfoThousands": ",",
                "sLoadingRecords": "{{ ('dataTable.general.language.sLoadingRecords') | trans }}",
                "oPaginate": {
                    "sFirst": "{{ ('dataTable.general.language.oPaginate.sFirst') | trans }}",
                    "sLast": "{{ ('dataTable.general.language.oPaginate.sLast') | trans }}",
                    "sNext": "{{ ('dataTable.general.language.oPaginate.sNext') | trans }}",
                    "sPrevious": "{{ ('dataTable.general.language.oPaginate.sPrevious') | trans }}",
                },
                "oAria": {
                    "sSortAscending": ": {{ ('dataTable.general.language.oAria.sSortAscending') | trans }}",
                    "sSortDescending": ": {{ ('dataTable.general.language.oAria.sSortDescending') | trans }}"
                },
            },
            ajax: {
                url: "{{ path('parameters_table') }}",
                method: 'POST',
                data: {
                    'form_filters': $('#table_parameters').serialize(),
                    'search_filter': $('#search-input').val(),
                }
            },
            initComplete: function() {},
            drawCallback: function() {
                $.fn.editable.defaults.mode = 'inline';

                $('.edit_name, .edit_type, .edit_value, .edit_description').editable({
                    type: $(this).data('type'),
                    pk: $(this).data('pk'),
                    name: $(this).data('name'),
                    url: $(this).data('url'),
                    title: $(this).data('value')
                });
            },
            columns: [
                {data: {}, render: function(data, row) {
                        html = '<a href="#" class="editable editable-click edit_name" data-type="text" data-pk="'+ data['id'] +'" data-name="name" data-url="{{path('edit_parameter')}}">'+ data['name'] +'</a>';
                        return html;
                    }
                },
                {data: {}, render: function(data, row) {
                        html = '<a href="#" class="editable editable-click edit_type" data-type="text" data-pk="'+ data['id'] +'" data-name="type" data-url="{{path('edit_parameter')}}">'+ data['type'] +'</a>';
                        return html;
                    }
                },
                {data: {}, render: function(data, row) {
                        html = '<a href="#" class="editable editable-click edit_value" data-type="text" data-pk="'+ data['id'] +'" data-name="value" data-url="{{path('edit_parameter')}}">'+ data['value'] +'</a>';
                        return html;
                    }
                },
                {data: {}, render: function(data, row) {
                        html = '<a href="#" class="editable editable-click edit_description" data-type="textarea" data-pk="'+ data['id'] +'" data-name="description" data-url="{{path('edit_parameter')}}">'+ data['description'] +'</a>';
                        return html;
                    }
                }
            ]
        });
    }

    {# Funci√≥n encargada de recargar el ajax del datatable #}
    let reloadDataTable = function() {
        $("#table_parameters").DataTable().destroy();
        createTable();
    }
    {# ################################################### #}

</script>


{% endblock %}